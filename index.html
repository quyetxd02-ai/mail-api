<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quản lý Email Online - Auto Filter</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    button { font-size: 16px; width: 90%; max-width: 340px; margin-top: 10px; padding: 12px; border-radius: 6px; border: none; cursor: pointer; color: white; }
    #syncApiButton { background: #17a2b8; } #syncApiButton:hover { background: #117a8b; }
    #deleteListButton { background: #dc3545; } #deleteListButton:hover { background: #a71d2a; }
    #copyButton { background: #28a745; } #copyButton:hover { background: #1c7c31; }
    #manualCopyButton { background: #007bff; width: 60px; } #manualCopyButton:hover { background: #0056b3; }
    input { font-size: 16px; padding: 12px; width: 90%; max-width: 280px; margin-top: 10px; border-radius: 6px; border: 1px solid #ccc; }
    .input-container { display: flex; gap: 10px; align-items: center; width: 90%; max-width: 340px; margin-top: 10px; }
    #customToast { position: fixed; top: -100px; left: 0; width: 100%; background: #343a40; color: white; text-align: center; padding: 16px 10px; font-size: 18px; font-weight: bold; z-index: 9999; transition: top 0.5s ease-in-out; }
    #customToast.show { top: 0; } #customToast.error { background: #d93025; } #customToast.success { background: #28a745; }
  </style>
</head>
<body>
<div id="customToast"></div>

<h3 style="text-align: center; line-height: 1.4;">
  📨 Quản lý danh sách Email Online<br>
  Design by Bảo
</h3>

<button id="syncApiButton">📡 Đồng bộ Email từ API</button>
<button id="deleteListButton">🗑️ Xóa Danh Sách Email</button>

<div class="input-container">
  <input type="text" id="emailOutput" placeholder="Email sẽ xuất hiện ở đây" readonly>
  <button id="manualCopyButton">📋</button>
</div>

<p id="count"></p>
<button id="copyButton">📋 Lấy & Copy Email</button>

<script>
  // 🔥 Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBr3rKT-fDNQc-rz84k6haRMs_WfXoU6kI",
    authDomain: "mail-9c51f.firebaseapp.com",
    databaseURL: "https://mail-9c51f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "mail-9c51f",
    storageBucket: "mail-9c51f.firebasestorage.app",
    messagingSenderId: "240185286356",
    appId: "1:240185286356:web:a9273c909ae18e36b86541",
    measurementId: "G-0XHQ657PH8"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const emailRef = db.ref('emails');

  let emailList = [];

  function showToast(msg, isError = false, isSuccess = false) {
    const toast = document.getElementById('customToast');
    toast.textContent = msg;
    toast.className = '';
    toast.classList.add('show');
    if (isError) toast.classList.add('error');
    if (isSuccess) toast.classList.add('success');
    setTimeout(() => { toast.classList.remove('show'); }, 4000);
  }

  function updateCount() {
    document.getElementById('count').textContent = `📊 Số email còn lại: ${emailList.length}`;
  }

  // 📡 Đồng bộ từ API
  async function fetchEmailsFromAPI() {
    try {
      const response = await fetch("https://example.com/api/emails", {
        headers: {
          "Authorization": "Bearer e55b0f45e746fd65b1c7d01f99596fdccM7KGCYvfXA1rO680a5nJiIRskoEUBqV"
        }
      });
      if (!response.ok) throw new Error("API lỗi hoặc không truy cập được");

      const data = await response.json();
      const fetchedEmails = data.emails || [];

      if (fetchedEmails.length === 0) {
        showToast("⚠️ API không trả về email nào.", true);
        return;
      }

      emailRef.transaction(currentList => {
        const updatedList = currentList ? currentList.slice() : [];
        fetchedEmails.forEach(email => {
          if (!updatedList.includes(email)) updatedList.push(email);
        });
        return updatedList;
      }, (error, committed, snapshot) => {
        if (error || !committed) {
          showToast("⚠️ Không thể đồng bộ email từ API.", true);
        } else {
          emailList = snapshot.val() || [];
          showToast(`✅ Đã thêm ${fetchedEmails.length} email từ API.`, false, true);
          updateCount();
        }
      });

    } catch (err) {
      showToast("⚠️ Lỗi khi gọi API: " + err.message, true);
    }
  }
  document.getElementById("syncApiButton").addEventListener("click", fetchEmailsFromAPI);

  // 🗑️ Xóa toàn bộ email
  document.getElementById('deleteListButton').addEventListener('click', () => {
    if (!confirm("Bạn có chắc muốn xóa toàn bộ danh sách email?")) return;
    emailRef.set([], (error) => {
      if (error) showToast('⚠️ Lỗi khi xóa danh sách.', true);
      else {
        showToast('✅ Đã xóa toàn bộ danh sách email.', false, true);
        emailList = [];
        updateCount();
      }
    });
  });

  // 📋 Copy email
  function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
      showToast(`✅ Đã copy: ${text}`, false, true);
    }).catch(() => showToast('⚠️ Không thể copy.', true));
  }
  document.getElementById('manualCopyButton').addEventListener('click', () => {
    const email = document.getElementById('emailOutput').value;
    if (!email) { showToast('⚠️ Không có email để copy.', true); return; }
    copyText(email);
  });
  document.getElementById('copyButton').addEventListener('click', () => {
    if (emailList.length === 0) {
      showToast('⚠️ Danh sách đã hết email.', true);
      return;
    }
    const randomIndex = Math.floor(Math.random() * emailList.length);
    const email = emailList[randomIndex];
    document.getElementById('emailOutput').value = email;
    copyText(email);
    emailRef.transaction(currentList => {
      if (!currentList) return null;
      const idx = currentList.indexOf(email);
      if (idx !== -1) currentList.splice(idx, 1);
      return currentList;
    }, (error, committed, snapshot) => {
      if (committed) {
        emailList = snapshot.val() || [];
        updateCount();
      }
    });
  });

  // 🔄 Lắng nghe Firebase
  emailRef.on('value', snapshot => {
    emailList = snapshot.val() ? snapshot.val() : [];
    updateCount();
  });
</script>
</body>
</html>
👉 Giờ bạn chỉ việc sửa https://example.com/api/emails thành API thật của bạn (trả về JSON dạng:

json
Sao chép mã
{ "emails": ["a@test.com", "b@test.com"] }
```)  
là chạy được.  

Bạn có muốn mình viết luôn ví dụ **API backend trả JSON email** để test thử không?






Bạn đã nói:
tối giản giao diện.


ChatGPT đã nói:
Ok 👍 mình sẽ tối giản lại giao diện: chỉ giữ tiêu đề, nút Đồng bộ Email từ API, nút Copy Email, và hiển thị số lượng email còn lại.
Mình bỏ màu mè thừa, chỉ dùng layout gọn nhẹ, dễ nhìn.

Đây là bản rút gọn:

html
Sao chép mã
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email Manager</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    h2 { margin-bottom: 20px; }
    button { font-size: 15px; padding: 10px 16px; margin: 6px; border: none; border-radius: 5px; cursor: pointer; color: white; }
    #syncApiButton { background: #17a2b8; }
    #copyButton { background: #28a745; }
    #deleteListButton { background: #dc3545; }
    #emailOutput { margin-top: 12px; font-size: 15px; padding: 8px; width: 240px; border: 1px solid #ccc; border-radius: 5px; }
    #count { margin-top: 10px; font-weight: bold; }
    #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 5px; display: none; }
  </style>
</head>
<body>
  <h2>📧 Email Manager</h2>

  <button id="syncApiButton">📡 Đồng bộ từ API</button>
  <button id="copyButton">📋 Copy Email</button>
  <button id="deleteListButton">🗑️ Xóa danh sách</button>

  <input type="text" id="emailOutput" readonly placeholder="Email sẽ hiển thị ở đây">
  <p id="count">📊 Số email còn lại: 0</p>

  <div id="toast"></div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBr3rKT-fDNQc-rz84k6haRMs_WfXoU6kI",
    authDomain: "mail-9c51f.firebaseapp.com",
    databaseURL: "https://mail-9c51f-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "mail-9c51f",
    storageBucket: "mail-9c51f.firebasestorage.app",
    messagingSenderId: "240185286356",
    appId: "1:240185286356:web:a9273c909ae18e36b86541"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const emailRef = db.ref('emails');

  let emailList = [];

  function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.style.display = "block";
    setTimeout(()=> t.style.display="none", 2500);
  }

  function updateCount() {
    document.getElementById("count").textContent = `📊 Số email còn lại: ${emailList.length}`;
  }

  // 📡 Đồng bộ từ API
  async function fetchEmailsFromAPI() {
    try {
      const response = await fetch("https://example.com/api/emails", {
        headers: { "Authorization": "Bearer e55b0f45e746fd65b1c7d01f99596fdccM7KGCYvfXA1rO680a5nJiIRskoEUBqV" }
      });
      if (!response.ok) throw new Error("API lỗi");
      const data = await response.json();
      const fetchedEmails = data.emails || [];
      if (fetchedEmails.length === 0) { showToast("⚠️ Không có email mới"); return; }

      emailRef.transaction(list => {
        const updated = list ? list.slice() : [];
        fetchedEmails.forEach(e => { if (!updated.includes(e)) updated.push(e); });
        return updated;
      }, (err, ok, snap) => {
        if (ok) {
          emailList = snap.val() || [];
          updateCount();
          showToast(`✅ Thêm ${fetchedEmails.length} email`);
        }
      });
    } catch (err) { showToast("⚠️ Lỗi API"); }
  }

  // 📋 Copy email ngẫu nhiên
  function copyEmail() {
    if (emailList.length === 0) { showToast("⚠️ Hết email"); return; }
    const idx = Math.floor(Math.random() * emailList.length);
    const email = emailList[idx];
    document.getElementById("emailOutput").value = email;
    navigator.clipboard.writeText(email);
    emailRef.transaction(list => {
      if (!list) return [];
      list.splice(idx,1);
      return list;
    }, (err, ok, snap) => {
      if (ok) { emailList = snap.val()||[]; updateCount(); }
    });
    showToast(`📋 Đã copy: ${email}`);
  }

  // 🗑️ Xóa danh sách
  function clearList() {
    if (!confirm("Xóa toàn bộ email?")) return;
    emailRef.set([], err=>{
      if (!err) { emailList=[]; updateCount(); showToast("✅ Đã xóa"); }
    });
  }

  document.getElementById("syncApiButton").onclick = fetchEmailsFromAPI;
  document.getElementById("copyButton").onclick = copyEmail;
  document.getElementById("deleteListButton").onclick = clearList;

  // 🔄 Lắng nghe Firebase
  emailRef.on("value", snap => { emailList = snap.val()||[]; updateCount(); });
</script>
</body>
</html>
